# OKN
Набор скриптов и утилит, написанных на Python
для помощи волонтерам искать, собирать и систематизировать информацию об Объектах Культурного Наследия (ОКН).

## Установка

Склонировать репозиторий затем выполнить команды:

```shell
pipenv install
pipenv shell
```
Это создаст виртуальное окружение, установит все необходимые пакеты
и активирует консоль для выполнения команд.

### Настройка

Для работы потребуются настройки, которые нужно прописать в перменные окружения в файле `.env`.
Шаблон файла с настройками лежит в файле `.env.template`. Вы можете скопировать его командой:
```shell
cp .env.template .env
```
И затем заполнить параметры:

* `YANDEX_GEO_API_KEY` - API-ключ Геокодера
* `YANDEX_GEO_ENDPOINT` - Адрес для доступа к геокодеру. По умолчанию это - `https://geocode-maps.yandex.ru/1.x`
* `MAIN_AREA` - Область поиска координат. Например, если ОКН находятся в основном в Екатеринбурге, то стоит прописать
  `Свердловская область, г. Екатеринбург`. Указанная область поиска будет добавляться к каждому адресу, который вы ищите с помощью Геокодера.
 Это позволит сузить область поиска, так как назавания улиц часто называются одинаково в разных городах
* `FORM_LINK` - Ссылка на Google-форму для заполнения информации об объекте ОКН.
Она добавляется к описанию каждого объекта, чтобы предзаполнить поле с идентификатором объекта.

#### Геокодер

Для получения координат объекта по его адресу
используется сервис [Яндекс Геокодер](https://yandex.ru/dev/maps/geocoder/).
Нужно авторизоваться в Яндексе, получить API-ключ,
как описано в документации и положить его в переменную `YANDEX_GEO_API_KEY`.

## Данные

Для демонстрации работы скриптов используется сэмпл данных об ОКН Свердловской области.
Файл лежит в репозитории по пути `data/sample_okn_source.tsv` и имеет следующий формат:
* `id` - порядковый номер в исходной мастер-таблице. Его удобно использовать для того, чтобы затем склеивать данные
* `reg_id` - идентификационный номер в реестре ОКН. Используется для идентификации объекта
* `obj_name` - название объекта
* `date` - дата постройки (может отсутствовать или указываться приблизительно)
* `category` - категория объекта, определяющая регионального/федерального значения
* `type` - тип объекта, может быть "памятник" или "ансамбль"
* `act_number` - номер акта, в котором данных объект был признан ОКН
* `address` - адрес объекта, может отсутствовать или указан приблизительно.
  Именно это поле может быть использовано, чтобы определить координаты объекта и разместить его на карте


## Сбор информации о координатах

Для того, чтобы по заданному списку адресов собрать их координаты нужно выполнить скрипт:

```shell
python main.py map_geo_for_df '<путь до таблицы с иcходными данными>' '<результирующий json файл>'
```
Можно попробовать, как это работает на примере с данными:
```shell
python main.py map_geo_for_df 'data/sample_okn_source.tsv' 'okn_google.tsv' 
```
Результат запишется в файл `okn_google.tsv` (вы можете посмотреть как он выглядит в папке `data`)

Далее полученный файл можно будет импортировать, создав новую карту в сервисе [Google My Maps](https://www.google.com/maps/d/?hl=ru).

В процессе импорта мастер спросит какие колонки нужно использовать в качестве Долготы и Широты.
Пожалуйста, не перепутайте (иначе координаты будут проинтерпретированы неверно):
* x - Широта
* y - Долгота
* name - Название объекта.

## Раскладывание фотографий по папочкам

После того, как данные по анкете буду собраны, то у вас возникнет необходимость разложить фотографии по папочкам,
в соответствии с идентификатором объекта. Для этого нужно...

Раздел находится в разработке
